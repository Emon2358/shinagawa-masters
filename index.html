<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Fetchを使ったサイト表示サンプル</title>
  <style>
    body { margin: 0; padding: 20px; font-family: sans-serif; }
    form { margin-bottom: 20px; }
    #content { border: 1px solid #ccc; padding: 10px; }
  </style>
</head>
<body>
  <h1>表示するサイトのURLを入力してください</h1>
  <form id="fetchForm">
    <input type="text" id="urlInput" name="url" placeholder="https://example.com" required style="width:300px;">
    <button type="submit">表示</button>
  </form>
  
  <div id="content">ここにサイトが表示されます。</div>

  <script>
    document.getElementById('fetchForm').addEventListener('submit', function(event) {
      event.preventDefault();
      const url = document.getElementById('urlInput').value.trim();
      if (!url) {
        alert('URLを入力してください。');
        return;
      }
      fetchSite(url);
    });
    
    function fetchSite(targetUrl) {
      const contentDiv = document.getElementById('content');
      contentDiv.textContent = 'コンテンツを読み込み中…';
      
      fetch(targetUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('ネットワークエラー: ' + response.status);
          }
          return response.text();
        })
        .then(htmlText => {
          // HTMLテキストを DOM にパース
          const parser = new DOMParser();
          const doc = parser.parseFromString(htmlText, 'text/html');

          // <base>タグを設定し、すべての相対URLが対象サイトを基準に解決されるようにする
          let base = doc.querySelector('base');
          if (!base) {
            base = document.createElement('base');
            const head = doc.querySelector('head');
            if (head) {
              head.insertBefore(base, head.firstChild);
            }
          }
          base.setAttribute('href', targetUrl);

          // 取得した HTML の全体を表示用の div に挿入
          contentDiv.innerHTML = doc.documentElement.innerHTML;

          // ※ 注意: 動的に読み込まれる <script> タグなどは innerHTML での挿入では実行されない場合があります
        })
        .catch(error => {
          contentDiv.textContent = 'エラー: ' + error.message;
        });
    }
  </script>
</body>
</html>
